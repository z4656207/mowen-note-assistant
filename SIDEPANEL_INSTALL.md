# 墨问笔记助手 - 侧边栏功能安装指南

## 🚀 快速开始

### 1. 环境检查

确保您的浏览器支持侧边栏功能：
- ✅ Chrome 114+ 
- ✅ Edge 114+
- ❌ Firefox（不支持）
- ❌ Safari（不支持）

检查Chrome版本：
1. 打开Chrome浏览器
2. 地址栏输入 `chrome://version/`
3. 查看版本号是否 ≥ 114

### 2. 安装扩展

#### 方法一：开发者模式安装（推荐）

1. **打开扩展管理页面**
   - 在Chrome地址栏输入：`chrome://extensions/`
   - 或者：菜单 → 更多工具 → 扩展程序

2. **启用开发者模式**
   - 在页面右上角打开"开发者模式"开关

3. **加载扩展**
   - 点击"加载已解压的扩展程序"
   - 选择项目文件夹（包含manifest.json的文件夹）
   - 点击"选择文件夹"

4. **验证安装**
   - 扩展列表中应该出现"墨问笔记助手"
   - 浏览器工具栏应该显示扩展图标

#### 方法二：打包安装

```bash
# 如果需要打包成crx文件
# 在chrome://extensions/页面点击"打包扩展程序"
# 选择项目文件夹，生成.crx文件
```

### 3. 配置API密钥

1. **打开设置页面**
   - 右键扩展图标 → "选项"
   - 或者在扩展管理页面点击"详细信息" → "扩展程序选项"

2. **配置API密钥**
   - AI API密钥：输入您的AI服务API密钥
   - 墨问API密钥：输入您的墨问账户API密钥
   - API地址：通常使用默认值

3. **保存配置**
   - 点击"保存配置"按钮
   - 确认显示"配置保存成功"

## 🧪 功能测试

### 测试步骤

1. **打开测试页面**
   ```
   在浏览器中打开：test-sidepanel.html
   ```

2. **启动侧边栏**
   - 点击浏览器工具栏中的墨问笔记助手图标
   - 侧边栏应该在浏览器右侧打开

3. **测试持久化**
   - 点击测试页面中的按钮
   - 验证侧边栏不会关闭

4. **测试页面跟踪**
   - 打开新标签页
   - 切换回测试页面
   - 观察侧边栏内容是否更新

5. **测试任务处理**
   - 在侧边栏中点击"提取并发布"
   - 观察进度显示
   - 在任务进行中关闭侧边栏
   - 重新打开侧边栏，检查状态是否恢复

### 预期结果

✅ **正常情况**：
- 侧边栏正常打开并显示页面信息
- 点击页面其他位置侧边栏不关闭
- 切换标签页时内容自动更新
- 任务状态正确保存和恢复
- 所有功能正常工作

❌ **异常情况**：
- 侧边栏无法打开 → 检查Chrome版本和权限
- 内容不更新 → 检查内容脚本注入
- 任务状态丢失 → 检查存储权限

## 🔧 故障排除

### 常见问题

#### 1. 侧边栏无法打开

**可能原因**：
- Chrome版本过低
- 权限不足
- 扩展安装不完整

**解决方法**：
```bash
# 检查Chrome版本
chrome://version/

# 检查扩展权限
chrome://extensions/ → 详细信息 → 权限

# 重新加载扩展
chrome://extensions/ → 重新加载
```

#### 2. 页面内容无法提取

**可能原因**：
- 内容脚本注入失败
- 页面权限限制
- 网络连接问题

**解决方法**：
```javascript
// 在控制台检查错误
console.log('检查内容脚本是否注入');

// 手动刷新页面
location.reload();

// 检查网络连接
fetch('https://api.mowen.cn/health').then(r => console.log(r.status));
```

#### 3. 任务状态丢失

**可能原因**：
- 存储权限问题
- 浏览器存储限制
- 扩展重新加载

**解决方法**：
```javascript
// 检查存储状态
chrome.storage.local.get(null, (items) => {
  console.log('存储内容:', items);
});

// 清除存储重新开始
chrome.storage.local.clear();
```

### 调试工具

#### 1. 开发者工具

**侧边栏调试**：
- 右键侧边栏 → "检查"
- 查看Console标签的错误信息

**后台脚本调试**：
- `chrome://extensions/` → 详细信息 → "检查视图：Service Worker"
- 查看后台任务执行日志

#### 2. 存储检查

**查看任务状态**：
```javascript
// 在控制台执行
chrome.storage.local.get(null, console.log);
```

**清除所有状态**：
```javascript
// 强制重置（在侧边栏控制台执行）
chrome.storage.local.clear();
location.reload();
```

#### 3. 网络检查

**测试API连接**：
```javascript
// 测试墨问API
fetch('https://api.mowen.cn/health')
  .then(r => console.log('墨问API状态:', r.status))
  .catch(e => console.error('连接失败:', e));
```

## 📋 测试清单

在报告问题之前，请完成以下检查：

- [ ] Chrome版本 ≥ 114
- [ ] 扩展正确安装并启用
- [ ] API密钥已正确配置
- [ ] 侧边栏可以正常打开
- [ ] 页面内容可以正确提取
- [ ] 任务可以正常启动
- [ ] 状态可以正确保存和恢复
- [ ] 模式切换功能正常
- [ ] 桌面通知正常显示

## 🆘 获取帮助

如果问题仍然存在，请提供以下信息：

### 系统信息
- 操作系统：Windows/Mac/Linux
- Chrome版本：`chrome://version/`
- 扩展版本：在扩展管理页面查看

### 错误信息
- 控制台错误日志
- 网络请求失败信息
- 具体的操作步骤和现象

### 联系方式
- 📧 邮件：support@mowen.cn
- 🐛 GitHub Issues：[项目地址]/issues
- 💬 在线反馈：通过扩展内的反馈功能

---

**提示**：如果您的浏览器不支持侧边栏功能，扩展会自动回退到传统的弹窗模式，所有功能仍然可以正常使用。 