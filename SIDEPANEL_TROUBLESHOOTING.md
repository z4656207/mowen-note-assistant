# 墨问笔记助手 - 侧边栏故障排除指南

## 🚨 常见问题及解决方案

### 1. 侧边栏无法打开

#### 症状
- 点击扩展图标后侧边栏没有出现
- 浏览器右侧没有显示侧边栏界面

#### 可能原因及解决方案

**A. Chrome版本过低**
```
检查方法：
1. 地址栏输入 chrome://version/
2. 查看版本号是否 ≥ 114

解决方案：
- 升级Chrome到最新版本
- 或者切换到弹窗模式使用
```

**B. 扩展权限不足**
```
检查方法：
1. 打开 chrome://extensions/
2. 找到"墨问笔记助手"
3. 点击"详细信息"
4. 检查权限列表

解决方案：
- 确保扩展已启用
- 重新加载扩展
- 重新安装扩展
```

**C. Side Panel API不可用**
```
检查方法：
- 在控制台执行：console.log(!!chrome.sidePanel)
- 应该返回 true

解决方案：
- 确保使用支持的浏览器版本
- 重启浏览器
```

### 2. 侧边栏显示错误信息

#### 症状
- 侧边栏打开但显示错误
- 配置检查失败
- API密钥验证失败

#### 解决步骤

**Step 1: 检查配置**
```
1. 右键扩展图标 → "选项"
2. 确保所有API密钥都已正确配置：
   - AI API地址
   - AI API密钥
   - AI模型名称
   - 墨问API密钥
3. 点击"保存配置"
```

**Step 2: 验证配置格式**
```
AI API密钥格式：
- 长度应该 ≥ 10 字符
- 通常以 "sk-" 开头

墨问API密钥格式：
- 长度应该 ≥ 10 字符
- 从墨问官网获取

API地址格式：
- 必须是有效的URL
- 例如：https://api.openai.com/v1/chat/completions
```

**Step 3: 测试网络连接**
```
在侧边栏中：
1. 点击"诊断问题"按钮
2. 查看网络状态部分
3. 确保墨问API连接正常
```

### 3. 页面内容无法提取

#### 症状
- 显示"页面内容未准备就绪"
- 内容脚本注入失败

#### 解决方案

**A. 页面权限问题**
```
不支持的页面：
- chrome:// 开头的页面
- chrome-extension:// 开头的页面
- 某些受保护的网站

解决方案：
- 切换到支持的网页
- 确保页面完全加载完成
```

**B. 内容脚本注入失败**
```
检查方法：
1. 打开开发者工具
2. 查看Console是否有错误
3. 检查Network标签的请求状态

解决方案：
- 刷新页面后重试
- 检查扩展权限
- 重新加载扩展
```

### 4. 任务状态异常

#### 症状
- 任务卡在"正在处理"状态
- 任务状态丢失
- 进度不更新

#### 解决步骤

**Step 1: 强制重置**
```
方法1：键盘快捷键
- 按 Ctrl+Shift+R

方法2：三击页面标题
- 快速点击侧边栏中的页面标题3次

方法3：手动清除
- 在测试页面点击"清除所有数据"
```

**Step 2: 检查后台任务**
```
1. 打开 chrome://extensions/
2. 找到"墨问笔记助手"
3. 点击"检查视图：Service Worker"
4. 查看控制台日志
```

**Step 3: 重新启动任务**
```
1. 强制重置后
2. 重新配置API密钥
3. 重新启动内容提取任务
```

### 5. 模式切换问题

#### 症状
- 无法切换到弹窗模式
- 切换后功能异常

#### 解决方案

**A. 切换到弹窗模式**
```
1. 在侧边栏中点击"切换到弹窗模式"按钮
2. 关闭侧边栏
3. 重新点击扩展图标
4. 应该显示弹窗界面
```

**B. 切换回侧边栏模式**
```
1. 在弹窗中查找模式切换选项
2. 或者重新加载扩展
3. 默认会使用侧边栏模式
```

## 🔧 高级调试

### 开发者工具调试

**侧边栏调试**
```
1. 右键侧边栏界面
2. 选择"检查"
3. 查看Console标签的错误信息
4. 检查Network标签的网络请求
```

**后台脚本调试**
```
1. 打开 chrome://extensions/
2. 开启"开发者模式"
3. 找到扩展，点击"检查视图：Service Worker"
4. 查看后台任务执行日志
```

### 存储数据检查

**查看存储内容**
```javascript
// 在控制台执行
chrome.storage.local.get(null, console.log);
chrome.storage.sync.get(null, console.log);
```

**清除特定数据**
```javascript
// 清除任务状态
chrome.storage.local.clear();

// 清除配置
chrome.storage.sync.clear();
```

### 网络连接测试

**测试API连接**
```javascript
// 测试墨问API
fetch('https://api.mowen.cn/health')
  .then(r => console.log('状态:', r.status))
  .catch(e => console.error('错误:', e));

// 测试AI API（需要替换为实际地址）
fetch('YOUR_AI_API_URL', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer YOUR_API_KEY',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({test: true})
});
```

## 📞 获取帮助

如果以上方法都无法解决问题，请：

1. **收集错误信息**
   - 控制台错误日志
   - 网络请求失败信息
   - 具体的操作步骤

2. **提供系统信息**
   - 操作系统版本
   - Chrome版本
   - 扩展版本

3. **联系支持**
   - 📧 邮件：support@mowen.cn
   - 🐛 GitHub Issues
   - 💬 扩展内反馈功能

---

**提示**：大多数问题都可以通过重新加载扩展或强制重置状态来解决。如果问题持续存在，可能是配置或网络问题。 